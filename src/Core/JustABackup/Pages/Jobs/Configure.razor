@page "/jobs/configure"
@using JustABackup.Components.Forms;
@using JustABackup.Pages.Jobs.Components;
@inject NavigationManager NavManager
@inject IProviderRepository providerRepository

<PageTitle>Just A Backup - @(jobId > 0 ? "Modify" : "Create") Job</PageTitle>

@code {
    int jobId = 0;
    ExtendedMudForm form = null!;

    FormStepDetails? detailsStep;

    protected override void OnInitialized()
    {
        var uri = NavManager.ToAbsoluteUri(NavManager.Uri);
        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("jobId", out var _jobId))
        {
            jobId = Convert.ToInt32(_jobId);
        }
    }

    private void OnSubmit()
    {
        // do something
    }
}

<MudText Typo="Typo.h1">@(jobId > 0 ? "Modify" : "Create") Job</MudText>

<MudGrid Spacing="2">
    <MudItem xs="9">
        <MudPaper Class="pa-5" Elevation="0">
            <ExtendedMudForm @ref="form" OnValidSubmit="OnValidSubmit">
                <JustABackup.Pages.Jobs.Components.FormStepDetails @ref="detailsStep" />

                <MudButton Variant="Variant.Filled" Color="Color.Primary" DisableElevation="true" OnClick="@(()=>OnSubmit())">Validate</MudButton>
            </ExtendedMudForm>
        </MudPaper>
    </MudItem>

    <MudItem xs="3">
        <MudPaper Class="flex-none d-flex pa-5 justify-center" Elevation="0">
            <MudTimeline>
                <MudTimelineItem Color="Color.Primary">
                    <MudText>Job Definition</MudText>
                </MudTimelineItem>
                <MudTimelineItem>
                    <MudText>Configure backup provider</MudText>
                </MudTimelineItem>
                @if (detailsStep != null)
                {
                    foreach (var option in detailsStep.TransformProviders)
                    {
                        <MudTimelineItem>
                            <MudText>Configure transform provider @option.Name</MudText>
                        </MudTimelineItem>
                    }
                }
                <MudTimelineItem>
                    <MudText>Configure storage provider</MudText>
                </MudTimelineItem>
                <MudTimelineItem>
                    <MudText>Overview</MudText>
                </MudTimelineItem>
            </MudTimeline>
        </MudPaper>
    </MudItem>
</MudGrid>